<!DOCTYPE HTML>
<html>
    <head>
        <link rel="stylesheet" href="style.css">

        <script src="js/jquery-3.5.0.min.js"></script>
        <script src="js/jquery-ui-min.js"></script>
        <script src="js/script.js"></script>

        <style>
            body { margin: 0px; background: #7acd7a url("/images/bio_bg.png"); outline: 0px none; -webkit-appearance: none; -webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
            .game_canvas { position: absolute; top: 0px; right: 0px; bottom: 0px; left: 0px; margin: auto; padding: 14px 7px; width: 1075px; height: 650px; background-color: #f7f6f5; border: 1px solid #999; border-radius: 15px; box-shadow: 2px 2px 5px #999; }
        </style>
    </head>
    
    <body>
        <div class="button_close" onclick="history.back(-1)">x</div>
        
        <div class="game_canvas">
            <div>Welche Merkmale würdest du den Meeressäugern zuordnen? Note: We are working on hand drawn images.</div>         
            
            <div id="image_source" class="image_row mt10"></div>
            <div id="image_destination_top_true" class="image_row"></div>                
                <div style="margin: auto;">
                    <div class="image_destination_left_true"></div>
                    <div class="game_droppable">
                        <div class="image_whale"><div class="arrows"><div class="image_whale baby"></div></div></div>                            
                    </div>
                    <div class="image_destination_right_true"></div>
                </div>             
            <div id="image_destination_false" class="image_row"></div>            
        </div>

        <div class="game_modal">
            <div class="game_modal_content">
                <span class="game_modal_head"></span>
                <div id="modalText" class="mt10"></div>
            </div>
        </div>

    <script>
        game_images = [
            { image_id: "1",  image_src: "/images/blasloch.png",          characteristic: "Blasloch",    correct: "true",  modalHead: "Korrekt!",                          modalText: "Wale brauchen Luft zum Atmen. Dazu müssen sie an die Wasseroberfläche schwimmen, um dort durch ihr <strong>Blasloch</strong> einzuatmen. Das Blasloch ist also die “Nase” des Wals, die sich auf die Kopfoberseite verlagert hat." },
            { image_id: "2",  image_src: "/images/fischeier.jpg",         characteristic: "Fischeier",   correct: "false", modalHead: "Denk nochmal nach, das ist falsch", modalText: "Fischweibchen legen ihre Eier im Wasser ab, wo sie von den Männchen befruchtet werden. Nach einiger Zeit schlüpfen dann kleine Fische aus den Eiern, die sich schon selbst versorgen können." },
            { image_id: "3",  image_src: "/images/blubber.jpg",           characteristic: "Blubber",     correct: "true",  modalHead: "Toll gemacht!",                     modalText: "Wie du vielleicht schon gelernt hast, sind Fische wechselwarme Tiere. Meeressäugetiere haben allerdings eine gleichbleibende Körpertemperatur, die sie durch Bewegung und ihre dicke Fettschicht - <strong>den Blubber</strong> - aufrechterhalten müssen." },
            { image_id: "4",  image_src: "/images/flosse_vertikal.png",   characteristic: "Fischflosse", correct: "false", modalHead: "Oje, das ist nicht richtig",        modalText: "Bei den Fischen ist die Schwanzflosse vertikal ausgerichtet, sie bewegt sich beim Schwimmen von links nach rechts. Beim Wal ist die Schwanzflosse waagerecht ausgerichtet, sie bewegt sich von oben nach unten." },
            { image_id: "5",  image_src: "/images/kiemen.jpg",            characteristic: "Kiemen",      correct: "false", modalHead: "Das ist leider nicht richtig",      modalText: "Im Gegensatz zu Fischen haben Meeressäuger - wie alle Säugetiere - Lungen und keine Kiemen. Das heißt, sie können unter Wasser nicht atmen, sondern müssen immer wieder an die Wasseroberfläche kommen um Luft zu holen. Das hört sich vielleicht unpraktisch an, aber manche Wale können so bis zu 2 Stunden unter Wasser bleiben." },
            { image_id: "6",  image_src: "/images/lunge_small.jpg",       characteristic: "Lunge",       correct: "true",  modalHead: "Super, das ist richtig!",           modalText: "Im Gegensatz zu Fischen haben Meeressäuger - wie alle Säugetiere - <strong>Lungen</strong> und keine Kiemen. Das heißt, sie können unter Wasser nicht atmen, sondern müssen immer wieder an die Wasseroberfläche kommen um Luft zu holen. Das hört sich vielleicht unpraktisch an, aber manche Wale können so bis zu 2 Stunden unter Wasser bleiben." },
            { image_id: "7",  image_src: "/images/schuppen_small.jpg",    characteristic: "Schuppen",    correct: "false", modalHead: "Leider falsch!",                    modalText: "Anders als Fische haben Wale keine Schuppen. Sie haben sehr feine Härchen auf ihrer Haut, so wie auch du! Diese blieben über aus der Zeit, als sie noch an Land gelebt haben." },
            { image_id: "8",  image_src: "/images/flosse_horizontal.png", characteristic: "Fluke",       correct: "true",  modalHead: "Das ist richtig!",                  modalText: "Meeressäuger haben zwar auch Flossen, jedoch sind sie anders aufgebaut als bei Fischen. Wale haben eine waagerechte Schwanzflosse - <strong>die Fluke</strong> -, die sich nach oben und unten bewegt und sie so nach vorne bringt." },
            { image_id: "9",  image_src: "/images/brutpflege_small.jpg",  characteristic: "Brutpflege",  correct: "true",  modalHead: "Toll, das stimmt!",                 modalText: "Bekanntlich bringen Säugetiere ihren Nachwuchs lebend zur Welt. Aber wie funktioniert das bei Meeressäugern? Auch bei ihnen entwickelt sich das Kind im Bauch der Mutter und wird im Wasser lebend geboren, bevor es den ersten Atemzug an der Oberfläche macht. Die Mutter kümmert sich um das Kalb und säugt es noch etwa 4 Monate bis zu 1 Jahr nach der Geburt." },
            { image_id: "10", image_src: "/images/fell_small.jpg",        characteristic: "Fell ",       correct: "false", modalHead: "Das stimmt leider nicht.",          modalText: "Obwohl Wale Säugetiere sind, haben sie kein Fell, so wie die meisten ihrer landlebenden Verwandten. Sie haben feine Härchen auf der Haut- so wie auch du!" },
        ];

        var image = {};
        var id = 0;
        var dropCounter = 0;

        $(document).ready(function() {
            for (image of game_images) {
                $("#image_source").append(
                '<div id="image_' + image.image_id + '" class="image_cell" style="background-image: url(' + image.image_src + ')">' + 
                '</div>')
                var setID = "#image_" + image.image_id;
                $(setID).append('<div id="label_' + image.image_id +'" class="image_label"></div>');
                addLabel(image.image_id);
                
                addDraggable(setID)

                if (image.image_id == 6) {
                    $(".image_destination_left_true").append('<div id="#image_true_' + image.image_id + '" class="image_true border_true left_right" style="background-image: url(' + image.image_src + ')"  onclick="showModal(' + image.image_id + ')"></div>');
                }
                if (image.image_id == 9) {
                    $(".image_destination_right_true").append('<div id="#image_true_' + image.image_id + '" class="image_true border_true left_right" style="background-image: url(' + image.image_src + ')"  onclick="showModal(' + image.image_id + ')"></div>');
                }
                if (image.image_id == 1) {
                    $("#image_destination_top_true").append('<div id="#image_true_' + image.image_id + '" class="image_true border_true top" style="background-image: url(' + image.image_src + '); margin-right: 85px;"  onclick="showModal(' + image.image_id + ')"></div>');
                }
                if (image.image_id == 3) {
                    $("#image_destination_top_true").append('<div id="#image_true_' + image.image_id + '" class="image_true border_true top" style="background-image: url(' + image.image_src + '); margin-right: 85px;"  onclick="showModal(' + image.image_id + ')"></div>');
                }
                if (image.image_id == 8) {
                    $("#image_destination_top_true").append('<div id="#image_true_' + image.image_id + '" class="image_true border_true top" style="background-image: url(' + image.image_src + ')"  onclick="showModal(' + image.image_id + ')"></div>');
                }
            }   
            addDroppable();
        });

        function addLabel(id) {
            $("#label_" + id).text(image.characteristic);
        }

        // ---------- open and close modal dialog ----------
        function showModal(id) {
            if (game_images[(id - 1)].correct == "false") {
                $(".game_modal_head").css("color", "#ff6666");
                
            } else {
                $(".game_modal_head").css("color", "#229922");
            }
            if ($("#image_" + image.image_id).is(".ui-draggable")) {
                    $(".game_modal_head").text(game_images[(id - 1)].modalHead);  
                }   else {
                    $(".game_modal_head").text(game_images[(id - 1)].characteristic);
                }
            
            $("#modalText").html(game_images[(id - 1)].modalText);                
            $(".game_modal").show("fade", "fast");
            $(".game_modal_content").center(true);
        }

        $(window).click(function(e) {                
            if (e.target.className == "game_modal") {                   
                $(".game_modal").hide("fade", "fast");

                console.log("Is image " + image.image_id + " draggable? " + $("#image_" + image.image_id).is(".ui-draggable"));

                if ($("#image_" + image.image_id).is(".ui-draggable") && image.correct == "false") {
                    console.log("draggable!");
                    removeDraggable();
                    moveElement(false);
                } else if ($("#image_" + image.image_id).is(".ui-draggable")) {
                    removeDraggable();
                    $("#image_" + image.image_id).addClass("border_true");
                    if (dropCounter === 5) moveElement(true);
                    /*if (image.image_id == 1) {
                        $("#image_1").animate({ top: $(".game_droppable").offset().top + "px", left: $(".game_droppable").offset().left + "px" }, 1000);
                    }*/
                }    
            }    
        });

        // ---------- drag and drop ----------
        function addDraggable(setID) {
            $(setID).draggable({
                revert: "invalid",
                containment: "window",
                scroll: false, 
                stack: ".image_cell",
                start: function() {
                    var id      = $(this).attr("id");
                    var regex   = /image_(\d+)/;
                    image       = game_images[parseInt(regex.exec(id)[1]) - 1];
                    console.log(image.image_id);
                },                                                                  
            });
        }

        function addDroppable() {
            $(".game_droppable").droppable({
                hoverClass: "highlight",
                drop: function(event, ui) {
                    if (image.correct == "true") dropCounter++;
                    showModal(image.image_id);            
                }   
            });
        }

        function removeDraggable() {
            $("#image_" + image.image_id).draggable("destroy").css("cursor", "default");
        }

        function moveElement(moveAll) {
            if (moveAll) {
                console.log("move all: ");
                for (image of game_images) {
                    if ($("#image_" + image.image_id).is(".ui-draggable") && image.correct == "false") {
                        $("#image_destination_false").append('<div id="#image_false_' + image.image_id + '" class="image_false" style="background-image: url(' + image.image_src + ')"  onclick = "showModal(' + image.image_id + ')"></div>');
                        //$("#image_false_" + image.image_id).append('<div id="label_' + (image.image_id + "moved") +'" class="image_label"></div>');
                        //addLabel((image.image_id + "moved"));
                        animation(image.image_id);
                        removeDraggable();
                    }  else {
                    animation(image.image_id);
                    setTimeout(function(){ jQuery(".image_whale").fadeIn(3500, "swing") }, 1500);
                    setTimeout(function(){ jQuery(".arrows").fadeIn(3500, "swing") }, 5000);
                    }          
                } 
            } else {
                console.log("move id: " + image.image_id);
                $("#image_destination_false").append('<div id="#image_false_' + image.image_id + '" class="image_false" style="background-image: url(' + image.image_src + ')"  onclick = "showModal(' + image.image_id + ')"></div>');
                //$("#image_false_" + image.image_id).append('<div id="label_' + (image.image_id + "moved") +'" class="image_label"></div>');
                //addLabel((image.image_id + "moved"));
                animation(image.image_id);
            }
        }

        function animation(id) {
            $("#image_" + id).animate({ opacity: "0%" }, 1500);
            $(".image_" + image.correct).animate({ opacity: "100%" }, 3000);
        }   

            //$("#image_1").animate({ top: $(".game_droppable").offset().top + "px", left: $(".game_droppable").offset().left + "px" }, 1000);
            //image_destination.appendChild(image);

    </script>
    </body>
</html>
